<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>集合面试题 | Java</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.3.0">
    <link rel="preload stylesheet" href="/java/assets/style.CwNKAmM-.css" as="style">
    
    <script type="module" src="/java/assets/app.L_EkR0us.js"></script>
    <link rel="preload" href="/java/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/java/assets/chunks/framework.BhDBw5OP.js">
    <link rel="modulepreload" href="/java/assets/chunks/theme.D1P4lzWJ.js">
    <link rel="modulepreload" href="/java/assets/basic_collection_CollectionInterviewQuestions.md.DYcJFf2V.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar has-sidebar top" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-0ad69264><a class="title" href="/java/" data-v-0ad69264><!--[--><!--]--><!----><span data-v-0ad69264>Java</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-afb2845e data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-af5898d3><span class="text" data-v-af5898d3><!----><span data-v-af5898d3>Java基础</span><span class="vpi-chevron-down text-icon" data-v-af5898d3></span></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-f51f088d><a class="VPLink link active" href="/java/basic/collection/CollectionInterviewQuestions.html" data-v-f51f088d><!--[-->集合相关<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-af5898d3><span class="text" data-v-af5898d3><!----><span data-v-af5898d3>数据库</span><span class="vpi-chevron-down text-icon" data-v-af5898d3></span></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-f51f088d><a class="VPLink link" href="/java/mysql/MySQLInterviewQuestions.html" data-v-f51f088d><!--[-->MySQL<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-f51f088d><a class="VPLink link" href="/java/redis/RedisInterviewQuestions.html" data-v-f51f088d><!--[-->Redis<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-af5898d3><span class="text" data-v-af5898d3><!----><span data-v-af5898d3>并发编程</span><span class="vpi-chevron-down text-icon" data-v-af5898d3></span></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-f51f088d><a class="VPLink link" href="/java/juc/JUCInterviewQuestions.html" data-v-f51f088d><!--[-->JUC<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-af5898d3><span class="text" data-v-af5898d3><!----><span data-v-af5898d3>项目实战</span><span class="vpi-chevron-down text-icon" data-v-af5898d3></span></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-f51f088d><a class="VPLink link" href="/java/projects/tingshu/01-GettingStart.html" data-v-f51f088d><!--[-->听书项目(仿喜马拉雅)<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/pengbin2367/java" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-af5898d3><span class="vpi-more-horizontal icon" data-v-af5898d3></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/pengbin2367/java" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-883964e0><button data-v-883964e0>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 has-active" data-v-51288d80 data-v-edd2eed8><div class="item" role="button" tabindex="0" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><h2 class="text" data-v-edd2eed8>Java基础</h2><!----></div><div class="items" data-v-edd2eed8><!--[--><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/java/basic/collection/CollectionIntro.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>Java集合概述</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/java/basic/collection/CollectionOfHashMap.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>深入Java集合系列之——HashMap</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/java/basic/collection/CollectionInterviewQuestions.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>集合面试题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-edd2eed8 data-v-edd2eed8><div class="item" data-v-edd2eed8><div class="indicator" data-v-edd2eed8></div><a class="VPLink link link" href="/java/basic/javase/JavaSEInterviewQuestions.html" data-v-edd2eed8><!--[--><p class="text" data-v-edd2eed8>JavaSE面试题</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _java_basic_collection_CollectionInterviewQuestions" data-v-e6f2a212><div><h1 id="集合面试题" tabindex="-1">集合面试题 <a class="header-anchor" href="#集合面试题" aria-label="Permalink to &quot;集合面试题&quot;">​</a></h1><h2 id="java-集合框架是什么-说出集合框架的一些优点" tabindex="-1">Java 集合框架是什么？说出集合框架的一些优点 <a class="header-anchor" href="#java-集合框架是什么-说出集合框架的一些优点" aria-label="Permalink to &quot;Java 集合框架是什么？说出集合框架的一些优点&quot;">​</a></h2><p>每种编程语言中都有集合，最初的 Java 版本包含的集合类有：Vector、Stack、HashTable 和 Arrays。随着集合的广泛使用，Java2 提出了攘括所有集合接口和实现类、算法的集合框架。</p><p>在保证线程安全的情况下使用泛型和并发集合类，Java 已经经历了很久。集合框架的部分优点如下：</p><ol><li>使用核心集合类降低开发成本，而非实现我们自己的集合类</li><li>使用经过严格测试的集合框架类，代码质量会得到提高</li><li>通过使用 JDK 自带的集合类，可以降低代码维护成本</li><li>服用型和可操作性</li></ol><p>详情参考 <a href="/java/basic/collection/CollectionIntro.html">Java 集合框架概述</a></p><h2 id="集合接口的常见实现类" tabindex="-1">集合接口的常见实现类 <a class="header-anchor" href="#集合接口的常见实现类" aria-label="Permalink to &quot;集合接口的常见实现类&quot;">​</a></h2><h3 id="list-接口的实现类" tabindex="-1">List 接口的实现类 <a class="header-anchor" href="#list-接口的实现类" aria-label="Permalink to &quot;List 接口的实现类&quot;">​</a></h3><p>List 接口常用的实现类有 ArrayList、LinkedList 和 Vector：</p><ul><li>ArrayList 实现了可变的数组，可以根据索引位置对集合进行快速的随机访问</li><li>LinkedList 采用链表保存结构对象，便于向集合中插入和删除对象，但如果将元素插入到集合的尾部，其实 ArrayList 远比 LinkedList 快</li><li>Vector 也是 List 一个常见实现类，但是该类中大多数方法都加了 synchronized 关键字，因此相比 ArrayList 和 LinkedList，它在多线程访问时是线程安全的</li></ul><h3 id="set-接口的实现类" tabindex="-1">Set 接口的实现类 <a class="header-anchor" href="#set-接口的实现类" aria-label="Permalink to &quot;Set 接口的实现类&quot;">​</a></h3><p>Set 接口的实现类常用的有 HashSet、TreeSet 而 LinkedHashSet，它们的特点是元素都不可重复：</p><ul><li>HashSet 底层是哈希表，遍历元素和添加顺序、大小顺序无关</li><li>TreeSet 底层是红黑树，元素按照大小顺序存储和遍历</li><li>LinkedHashSet 底层是哈希表+红黑树，遍历元素可以体现添加时顺序，顺序性是体现和 HashSet 不同之处</li></ul><h3 id="map-接口的实现类" tabindex="-1">Map 接口的实现类 <a class="header-anchor" href="#map-接口的实现类" aria-label="Permalink to &quot;Map 接口的实现类&quot;">​</a></h3><p>Map 接口常用的实现类有 HashMap、TreeMap 和 LinkedHashMap，它们的 key 都不可重复（指的是容器中对于同一个 key 只会存在一个）：</p><ul><li>HashMap 也就是哈希表，底层是数组+链表+红黑树，遍历元素和添加顺序、大小顺序无关</li><li>TreeMap 底层是红黑树，元素按照 key 大小顺序存储和遍历</li><li>LinkedHashMap 底层是哈希表+双链表，遍历元素可以体现添加顺序</li></ul><h2 id="list-和-map-区别" tabindex="-1">List 和 Map 区别 <a class="header-anchor" href="#list-和-map-区别" aria-label="Permalink to &quot;List 和 Map 区别&quot;">​</a></h2><p>在数据结构方面，List 存储的是单列数据的集合，而 Map 存储的是 key、value 类型的键值对数据集合。在数据存储方面，List 存储的数据是有序且可以重复的，而 Map 中存储的数据是无序（不用的子类也可以保证有序）且 key 值不会重复（value 值可以重复）</p><h2 id="list、map、set-三个接口-存取元素时-各有什么特点" tabindex="-1">List、Map、Set 三个接口，存取元素时，各有什么特点 <a class="header-anchor" href="#list、map、set-三个接口-存取元素时-各有什么特点" aria-label="Permalink to &quot;List、Map、Set 三个接口，存取元素时，各有什么特点&quot;">​</a></h2><p>List 和 Set 具有相似性，它们都是单列元素的集合，所以，它们有一个共同的父接口，叫 Collection.</p><p>Set 是无序且不可重复的，Set 取元素时，不能通过索引访问元素，只能通过 for 循环或者迭代器逐一遍历各个元素。</p><p>List 表示有先后顺序的集合，注意，不是那种按年龄、按大小、按价格之类的排序。当我们多次调用 add(Object e)方法时，每次加入的对象就像火车站买票有排队顺序一样，按先来后到的顺序排序。有时候，也可以插队，即调用 add(int index, Object e)方法，就可以指定当前对象在集合中的存放位置。一个对象可以被反复存储进 List 中，每调用一次 add 方法，这个对象就被插入进集合中一次，其实，并不是把这个对象本身存储进了集合，而是在集合中用一个索引变量指向这个对象，当这个对象被 add 多次时，即相当于集合中有多个索引指向了这个对象。List 除了通过迭代器逐一遍历各个元素，还可以调用 get(index x)来明确说明取第几个。</p><p>Map 和 List、Set 不同，它是双列的集合，用 put 方法存储一对 key/value，不能存储重复的 key。取则可以根据 key 获得相应的 value，即 get(Object key)返回值为 key 所对应的 value.另外，也可以获得所有的 key 的集合（map.keySet()），还可以获得所有的 value 的集合（map.values()），还可以获得 key 和 value 组合成的 Map.Entry 对象的集合（map.entrySet()）。</p><h2 id="为什么-map-接口不继承-collection-接口" tabindex="-1">为什么 Map 接口不继承 Collection 接口 <a class="header-anchor" href="#为什么-map-接口不继承-collection-接口" aria-label="Permalink to &quot;为什么 Map 接口不继承 Collection 接口&quot;">​</a></h2><p>首先，Map 提供的是键值对映射，而 Collection 提供的是一组数据，并不是键值对映射。</p><p>其次，如果 Map 继承了 Collection 接口，那么所有实现了 Map 接口的类到底是用 Map 的键值对映射数据还是用 Collection 的一组数据呢，而且 Map 如果继承了 Collection 接口的话还违反了面向对象的接口分离原则。</p><h2 id="iterator-和-listiterator-之间有什么区别" tabindex="-1">Iterator 和 ListIterator 之间有什么区别 <a class="header-anchor" href="#iterator-和-listiterator-之间有什么区别" aria-label="Permalink to &quot;Iterator 和 ListIterator 之间有什么区别&quot;">​</a></h2><ol><li>我们可以使用 Iterator 来遍历 Set 和 List 集合，而 ListIterator 只能遍历 List</li><li>Iterator 只可以向前遍历，而 ListIterator 可以双向遍历</li><li>ListIterator 从 Iterator 接口继承，然后添加了一些额外的功能，比如添加一个元素、替换一个元素、获取前面或后面元素的索引位置</li></ol><h2 id="集合框架中的泛型有什么优点" tabindex="-1">集合框架中的泛型有什么优点 <a class="header-anchor" href="#集合框架中的泛型有什么优点" aria-label="Permalink to &quot;集合框架中的泛型有什么优点&quot;">​</a></h2><ul><li><p>类型安全</p><p>通过使用泛型定义的变量的类型限制，编译器可以在非常高的层次上验证类型假设。没有泛型，这些假设就只能在程序员编码时候去考虑了</p></li><li><p>消除强制类型转换</p><p>消除源代码中的许多强制类型转换，这使得代码更加可读，并且减少了出错机会</p></li><li><p>更高的效率</p><p>在非泛型编程中，将简单类型作为引用类型传递时会引起 <code>装箱</code> 和 <code>拆箱</code> 操作，这两个过程都是具有很大开销的。引入泛型后，就不必进行装箱和拆箱操作了，所以运行效率相对较高</p></li></ul><h2 id="map-接口提供了哪些不同的集合视图" tabindex="-1">Map 接口提供了哪些不同的集合视图 <a class="header-anchor" href="#map-接口提供了哪些不同的集合视图" aria-label="Permalink to &quot;Map 接口提供了哪些不同的集合视图&quot;">​</a></h2><p>Map 接口提供了三个集合视图：</p><ol><li><p>Set keySet()</p><p>返回 map 中包含的所有 key 的一个 Set 视图。此 Set 集合是受 Map 支持的，Map 的变化会在集合中反应出来，反之亦然。当一个迭代器正在遍历一个此 Set 集合时，若 Map 被修改了（除迭代器自身的移除操作以外），迭代器的结果会变为不确定。此 Set 集合支持元素查找和删除，从此 Set 中删除元素会从 Map 中移除对应的映射，它不支持 add 和 addAll 添加操作</p></li><li><p>Collection values()</p><p>返回一个 Map 中包含的所有 value 的一个 Collection 视图。这个 Collection 受 Map 支持，Map 的变化会在 Collection 中反应出来，反之亦然。当一个迭代器正在遍历此 Collection 时，若 Map 被修改了（除迭代器自身的移除操作以外），迭代器的结果会变为不确定。此 Collection 集合支持元素查找和删除，从此 Collection 中删除元素会从 Map 中移除对应的映射，它不支持 add 和 addAll 添加操作</p></li><li><p>Set entrySet()</p><p>返回一个 Map 中包含的所有映射的一个 Set 集合视图。这个 Set 集合受 Map 支持，Map 的变化会在 Collection 中反应出来，反之亦然。当一个迭代器正在遍历一个此 Set 集合时，若 Map 被修改了（除迭代器自身的移除操作以外，以及对迭代器返回的 entry 进行 setValue 外），迭代器的结果会变为未定义。此 Set 集合支持元素查找和删除，从此 Set 中删除元素会从 Map 中移除对应的映射，它不支持 add 和 addAll 添加操作</p></li></ol><h2 id="jdk7-hashmap" tabindex="-1">JDK7 HashMap <a class="header-anchor" href="#jdk7-hashmap" aria-label="Permalink to &quot;JDK7 HashMap&quot;">​</a></h2><p>详情参考 <a href="/java/basic/collection/CollectionOfHashMap.html">深入 Java 集合系列之——HashMap</a></p><h2 id="jdk8-hashmap" tabindex="-1">JDK8 HashMap <a class="header-anchor" href="#jdk8-hashmap" aria-label="Permalink to &quot;JDK8 HashMap&quot;">​</a></h2><p>详情参考 <a href="/java/basic/collection/CollectionOfHashMap.html">深入 Java 集合系列之——HashMap</a></p><h2 id="jdk8-中的-hashmap-为什么要使用红黑树" tabindex="-1">JDK8 中的 HashMap 为什么要使用红黑树 <a class="header-anchor" href="#jdk8-中的-hashmap-为什么要使用红黑树" aria-label="Permalink to &quot;JDK8 中的 HashMap 为什么要使用红黑树&quot;">​</a></h2><p>当元素个数小于阈值（8）时，链表整体的插入查询效率要高于红黑树，但当元素个数大于此阈值时，链表整体的插入查询效率要低于红黑树。</p><h2 id="jdk8-中的-hashmap-什么时候将链表转化为红黑树" tabindex="-1">JDK8 中的 HashMap 什么时候将链表转化为红黑树 <a class="header-anchor" href="#jdk8-中的-hashmap-什么时候将链表转化为红黑树" aria-label="Permalink to &quot;JDK8 中的 HashMap 什么时候将链表转化为红黑树&quot;">​</a></h2><p>当发现链表中的元素个数大于 8 之后，还会判断当前数组的长度，如果数组长度小于 64 时，此时不会转化为红黑树，而是进行扩容。只有当链表中的元素个数大于 8，并且数组的长度大于等于 64 时才会将链表转为红黑树。</p><p>上面扩容的原因是，如果数组长度还比较小，就先利用扩容来缩小链表的长度。</p><h2 id="jdk7-与-jdk8-中的-hashmap-的不同点" tabindex="-1">JDK7 与 JDK8 中的 HashMap 的不同点 <a class="header-anchor" href="#jdk7-与-jdk8-中的-hashmap-的不同点" aria-label="Permalink to &quot;JDK7 与 JDK8 中的 HashMap 的不同点&quot;">​</a></h2><ul><li><p>JDK8 中使用来红黑树</p></li><li><p>JDK7 中链表的插入使用的是头插法，而 JDK8 使用的尾插法</p><p>头插法速度更快，无需遍历链表，但是在多线程扩容的情况下使用头插法会出现循环链表的问题，导致 CPU 飙升。而在 JDK8 中，反正要去计算链表当前节点的个数，需要遍历链表，因此直接使用尾插法</p></li><li><p>JDK7 的 Hash 算法比 JDK8 更复杂</p><p>Hash 算法越复杂，生成的 hashcode 则越散列，那么 HashMap 中的元素则更散列，更散列则 HashMap 的查询性能更好，JDK7 中没有红黑树，所以只能优化 Hash 算法使得元素更散列，而 JDK8 中增加了红黑树，查询性能得到了保障，所以可以简化一下 Hash 算法，毕竟 Hash 算法越复杂就越消耗 CPU</p></li><li><p>扩容的过程中 JDK7 中有可能会重新对 key 进行哈希（重新 Hash 跟哈希种子有关系），而 JDK8 中没有这部分逻辑</p></li><li><p>JDK8 中扩容的条件和 JDK7 中不一样，除开判断 size 是否大于阈值之外，JDK7 中还判断了 table [i] 是否为空，不为空的时候才会进行扩容，而 JDK8 中则没有该条件了</p></li><li><p>JDK8 中还多了一个 API：putIfAbsent(key, value)</p></li><li><p>JDK7 和 JDK8 扩容过程中转移元素的逻辑不一样，JDK7 是每次转移一个元素，JDK8 是先算出来当前位置上哪些元素在新数组的低位上，哪些在新数组的高位上，然后再一次性转移</p></li></ul><h2 id="jdk7-concurrenthashmap" tabindex="-1">JDK7 ConcurrentHashMap <a class="header-anchor" href="#jdk7-concurrenthashmap" aria-label="Permalink to &quot;JDK7 ConcurrentHashMap&quot;">​</a></h2><p>JDK7 ConcurrentHashMap 底层是由两层嵌套数组来实现的：</p><ol><li>ConcurrentHashMap 对象中有一个属性 segments，类型为 Segment []</li><li>Segment 对象中有一个属性 table，类型为 HashEntry []</li></ol><h3 id="put-流程" tabindex="-1">put 流程 <a class="header-anchor" href="#put-流程" aria-label="Permalink to &quot;put 流程&quot;">​</a></h3><ol><li>当调用 ConcurrentHashMap 的 put 方法时，先根据 key 计算出对应的 Segment 的数组下标 j, 确定好当前 key, value 应该插入到哪个 Segment 对象中，如果 segment [j] 为空，则利用自旋锁的方式在 j 位置生成一个 Segment 对象</li><li>然后调用 Segment 对象的 put 方法 <ol><li>Segment 对象的 put 方法会先加锁，然后也根据 key 计算出对应的 HashEntry 数据下标 i, 然后将 key, value 封装为 HashEntry 对象放入该位置，此过程和 JDK7 的 HashMap 的 put 方法一样，然后解锁 🔓</li><li>在加锁过程中逻辑比较复杂，先通过自旋加锁，如果超过一定次数就会直接阻塞</li></ol></li></ol><h2 id="jdk8-concurrenthashmap" tabindex="-1">JDK8 ConcurrentHashMap <a class="header-anchor" href="#jdk8-concurrenthashmap" aria-label="Permalink to &quot;JDK8 ConcurrentHashMap&quot;">​</a></h2><h3 id="put-流程-1" tabindex="-1">put 流程 <a class="header-anchor" href="#put-流程-1" aria-label="Permalink to &quot;put 流程&quot;">​</a></h3><ol><li><p>当向 ConcurrentHashMap 中 put 一个 key, value 时，首先根据 key 计算对应的数组下标 i, 如果该位置没有元素，则通过自旋的方法去向该位置赋值。如果该位置有元素，则 synchronized 会加锁</p></li><li><p>加锁成功之后，再判断该元素类型</p><ol><li>如果是链表节点则进行添加节点到链表中</li><li>如果是红黑树则添加节点到红黑树中</li></ol></li><li><p>添加成功后，判断是否需要进行树化</p></li><li><p>addCount, 这个方法的意思是 ConcurrentHashMap 的元素个数加 1, 但是这个操作也是需要并发安全的，并且元素个数加 1 成功后，会继续判断是否要进行扩容。如果需要，则会进行扩容，所以这个方法很重要</p></li><li><p>同时一个线程在 put 时如果发现当前 ConcurrentHashMap 正在进行扩容则会去帮组扩容</p></li></ol><h2 id="jdk7-concurrenthashmap-如何保证并发" tabindex="-1">JDK7 ConcurrentHashMap 如何保证并发 <a class="header-anchor" href="#jdk7-concurrenthashmap-如何保证并发" aria-label="Permalink to &quot;JDK7 ConcurrentHashMap 如何保证并发&quot;">​</a></h2><p>主要利用 Unsafe 操作 + ReentrantLock + 分段思想</p><p>主要使用了 Unsafe 操作中的：</p><ul><li>compareAndSwapObject：通过 CAS 的方式修改对象的属性</li><li>putOrderedObject：并发安全的给数组某个位置赋值</li><li>getObjectVolatile：并发安全的扩区数组某个位置元素</li></ul><p>分段思想是为了提高 ConcurrentHashMap 的并发量，分段属越高则支持的最大并发量越高，程序员可以通过 concurrencyLevel 参数来指定并发量。ConcurrentHashMap 的内部类 Segment 就是用来表示某一个段的。</p><p>每个 Segment 就是一个小型的 HashMap, 当调用 ConcurrentHashMap 的 put 方法时，最终会调用到 Segment 的 put 方法，而 Segment 类继承了 ReentrantLock, 所以 Segment 自带可重入锁，当调用到 Segment 的 put 方法时，会先利用可重入锁加锁，加锁成功后再将待插入的 key, value 插入到小型 HashMap 中，插入完成后解锁。</p><h2 id="jdk8-concurrenthashmap-如何保证并发" tabindex="-1">JDK8 ConcurrentHashMap 如何保证并发 <a class="header-anchor" href="#jdk8-concurrenthashmap-如何保证并发" aria-label="Permalink to &quot;JDK8 ConcurrentHashMap 如何保证并发&quot;">​</a></h2><p>主要利用 Unsafe 操作 + synchronized 关键字</p><p>Unsafe 操作的使用仍然和 JDk7 中类似，主要负责并发安全的修改对象属性或数组某个位置的值。</p><p>synchronized 主要负责在需要操作某个位置时进行加锁（该位置不为空），比如向某个位置的链表进行插入节点，向某个位置的红黑树插入节点</p><p>JDK8 中其实仍然有分段锁的思想，只不过 JDK7 中段数是可控制的，而 JDK8 中数组的每一个位置都有一把锁。</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><!----><div class="last-updated" data-v-1bcd8184><p class="VPLastUpdated" data-v-1bcd8184 data-v-1bb0c8a8>Last updated: <time datetime="2024-07-14T06:04:34.000Z" data-v-1bb0c8a8></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/java/basic/collection/CollectionOfHashMap.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>深入Java集合系列之——HashMap</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/java/basic/javase/JavaSEInterviewQuestions.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>JavaSE面试题</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"basic_collection_collectioninterviewquestions.md\":\"DYcJFf2V\",\"basic_collection_collectionintro.md\":\"CYyfD28h\",\"basic_collection_collectionofhashmap.md\":\"BfLR-0Kj\",\"basic_javase_javaseinterviewquestions.md\":\"CbsRf0r5\",\"index.md\":\"D5fBSxjb\",\"juc_jucinterviewquestions.md\":\"BUa923WK\",\"mysql_mysqlinterviewquestions.md\":\"Dc5NqX7p\",\"projects_tingshu_01-gettingstart.md\":\"J3x8YZ6Y\",\"projects_tingshu_02-albummanagement.md\":\"OIb5OfyN\",\"projects_tingshu_03-trackmanagement.md\":\"DkV8zJad\",\"projects_tingshu_04-userlogin.md\":\"TB8CQYyn\",\"projects_tingshu_05-albumsearch.md\":\"DGURE9K1\",\"projects_tingshu_06-albumdetails.md\":\"DYb_1GYT\",\"projects_tingshu_07-cacheconfig.md\":\"D1MQ2R-p\",\"projects_tingshu_08-ordermanagement.md\":\"DarOEbVT\",\"projects_tingshu_09-accountmanagement.md\":\"DvmfJS0i\",\"projects_tingshu_10-wxpayment.md\":\"UxydqhM4\",\"projects_tingshu_11-scheduletask.md\":\"DDXVcaam\",\"projects_tingshu_12-rabbitmqjob.md\":\"BdYIb5VK\",\"projects_tingshu_13-kafkajob.md\":\"Cqn2xs9f\",\"redis_redisinterviewquestions.md\":\"BS8RsNQN\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Java\",\"description\":\"A VitePress Site\",\"base\":\"/java/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"Java基础\",\"items\":[{\"text\":\"集合相关\",\"link\":\"/basic/collection/CollectionInterviewQuestions\"}]},{\"text\":\"数据库\",\"items\":[{\"text\":\"MySQL\",\"link\":\"/mysql/MySQLInterviewQuestions\"},{\"text\":\"Redis\",\"link\":\"/redis/RedisInterviewQuestions\"}]},{\"text\":\"并发编程\",\"items\":[{\"text\":\"JUC\",\"link\":\"/juc/JUCInterviewQuestions\"}]},{\"text\":\"项目实战\",\"items\":[{\"text\":\"听书项目(仿喜马拉雅)\",\"link\":\"/projects/tingshu/01-GettingStart\"}]}],\"sidebar\":{\"/basic/\":[{\"text\":\"Java基础\",\"items\":[{\"text\":\"Java集合概述\",\"link\":\"/basic/collection/CollectionIntro\"},{\"text\":\"深入Java集合系列之——HashMap\",\"link\":\"/basic/collection/CollectionOfHashMap\"},{\"text\":\"集合面试题\",\"link\":\"/basic/collection/CollectionInterviewQuestions\"},{\"text\":\"JavaSE面试题\",\"link\":\"/basic/javase/JavaSEInterviewQuestions\"}]}],\"/mysql/\":[{\"text\":\"MySQL\",\"items\":[{\"text\":\"MySQL面试题\",\"link\":\"/mysql/MySQLInterviewQuestions\"}]}],\"/redis/\":[{\"text\":\"Redis\",\"items\":[{\"text\":\"Redis面试题\",\"link\":\"/redis/RedisInterviewQuestions\"}]}],\"/juc/\":[{\"text\":\"并发编程\",\"items\":[{\"text\":\"JUC面试题\",\"link\":\"/juc/JUCInterviewQuestions\"}]}],\"/projects/tingshu/\":[{\"text\":\"听书项目\",\"items\":[{\"text\":\"准备工作\",\"link\":\"/projects/tingshu/01-GettingStart\"},{\"text\":\"专辑管理\",\"link\":\"/projects/tingshu/02-AlbumManagement\"},{\"text\":\"声音管理\",\"link\":\"/projects/tingshu/03-TrackManagement\"},{\"text\":\"用户登录\",\"link\":\"/projects/tingshu/04-UserLogin\"},{\"text\":\"专辑搜索\",\"link\":\"/projects/tingshu/05-AlbumSearch\"},{\"text\":\"专辑详情\",\"link\":\"/projects/tingshu/06-AlbumDetails\"},{\"text\":\"缓存切面\",\"link\":\"/projects/tingshu/07-CacheConfig\"},{\"text\":\"订单管理\",\"link\":\"/projects/tingshu/08-OrderManagement\"},{\"text\":\"账户管理\",\"link\":\"/projects/tingshu/09-AccountManagement\"},{\"text\":\"微信支付\",\"link\":\"/projects/tingshu/10-WxPayment\"},{\"text\":\"定时任务\",\"link\":\"/projects/tingshu/11-ScheduleTask\"},{\"text\":\"RabbitMQ\",\"link\":\"/projects/tingshu/12-RabbitMQJob\"},{\"text\":\"kafka\",\"link\":\"/projects/tingshu/13-KafkaJob\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/pengbin2367/java\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>